<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ASP.NET Core中的Program和Startup类 | 萝卜就着茶</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ASP.NET Core简介
 ASP.NET Core可用于构建Web应用, 移动应用后端的框架，它是开源且跨平台支持。ASP.NET Core应用可以在.NET Core或者完整的.NET Framework上运行。用户在构建解决方案时可以获得很高的灵活性，因为ASP.NET Core应用是由模块化的组件组成的。用户可以在Windows, Mac和Linux系统中进行跨平台开发并运行应用，A">
<meta property="og:type" content="article">
<meta property="og:title" content="ASP.NET Core中的Program和Startup类">
<meta property="og:url" content="http://sharecode.cc/2016/12/06/Aspnet-Core-Web-GetStarted/index.html">
<meta property="og:site_name" content="萝卜就着茶">
<meta property="og:description" content="ASP.NET Core简介
 ASP.NET Core可用于构建Web应用, 移动应用后端的框架，它是开源且跨平台支持。ASP.NET Core应用可以在.NET Core或者完整的.NET Framework上运行。用户在构建解决方案时可以获得很高的灵活性，因为ASP.NET Core应用是由模块化的组件组成的。用户可以在Windows, Mac和Linux系统中进行跨平台开发并运行应用，A">
<meta property="og:updated_time" content="2016-12-14T07:56:57.502Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ASP.NET Core中的Program和Startup类">
<meta name="twitter:description" content="ASP.NET Core简介
 ASP.NET Core可用于构建Web应用, 移动应用后端的框架，它是开源且跨平台支持。ASP.NET Core应用可以在.NET Core或者完整的.NET Framework上运行。用户在构建解决方案时可以获得很高的灵活性，因为ASP.NET Core应用是由模块化的组件组成的。用户可以在Windows, Mac和Linux系统中进行跨平台开发并运行应用，A">
  
    <link rel="alternate" href="/atom.xml" title="萝卜就着茶" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://sharecode.cc"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">萝卜就着茶</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Tianmin&#39;s Blog</a>
        </h2>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Aspnet-Core-Web-GetStarted" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/06/Aspnet-Core-Web-GetStarted/" class="article-date">
  <time datetime="2016-12-06T07:35:01.000Z" itemprop="datePublished">2016-12-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ASP.NET Core中的Program和Startup类
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p><strong>ASP.NET Core简介</strong></p>
<p> ASP.NET Core可用于构建Web应用, 移动应用后端的框架，它是开源且跨平台支持。ASP.NET Core应用可以在.NET Core或者完整的.NET Framework上运行。用户在构建解决方案时可以获得很高的灵活性，因为ASP.NET Core应用是由模块化的组件组成的。用户可以在Windows, Mac和Linux系统中进行跨平台开发并运行应用，ASP.NET Core的开源地址<a href="https://github.com/aspnet" target="_blank" rel="external">GitHub</a>.</p>
<p> ASP.NET Core不在以System.Web.dll为基础，比之前的ASP.NET更加的精简且模块化，现在以Nuget包为基础，用户可以根据需要只使用必要的包。ASP.NET Core较之前ASP.NET版本是Web应用和Web API有统一的构建模式、集成了流行的前端框架和开发流程、包含内置的依赖注入方案、轻量级且模块化的HTTP请求处理管道、 应用可以托管在IIS上，也可以自托管等。</p>
</li>
<li><p><strong>Program类</strong></p>
<p> 这个类在应用的根目下，是一个控制台程序，其中<code>Main</code>方法来构建Web服务器,使用<code>WebHostBuilder</code>来创建Web应用的宿主，这一过程使用建造者模式。方法中指定使用什么Web服务器，可以指定多个选项如<code>UseKestrel()</code>和<code>UseIISIntegration</code>,时用<code>UseStartup&lt;TStartup&gt;()</code>方法来指定应用的启动类，在TStartup类中配置应用的请求管道，用<code>UseContentRoo()</code>方法指定应用的根目录。<code>Build()</code>方法创建Web应用的宿主，<code>Run()</code>方法运行Web应用并开始监听HTTP请求。其中以<code>Use</code>为前缀的方法都由<code>IWebHostBuilder</code>接口的扩展方法来提供。</p>
<pre><code class="brush:csharp">     public class Program
     {
         public static void Main(string[] args)
         {
             var host = new WebHostBuilder()
                 .UseKestrel()
                 .UseContentRoot(Directory.GetCurrentDirectory())
                 .UseIISIntegration()
                 .UseStartup&lt;Startup&gt;()
                 .Build();

             host.Run();
         }
     }
</code></pre>
</li>
<li><p><strong>Startup类</strong></p>
<p> <code>Startup</code>类用来定义请求的处理管道、配置应用所需要时用的服务。ASP.NET应用最少要包含一个<code>Startup</code>类，当一个应用启动时，ASP.NET会在主程序集的所有命名空间中检索名字为<code>Startup</code>的类。<code>Startup</code>类不必须是公有的。如果有多个<code>Startup</code>类的情况，ASP.NET将会在工程的根命名空间中寻找一个，如果没有找到将继续按命名空间的字母顺序寻找。可以为不同的<a href="#">环境</a>分别定义<code>Startup</code>类，在运行时会根据不同的环境在挑选一个合适的。</p>
<ul>
<li><p><code>Startup</code>类的构造函数</p>
<p><code>Startup</code>可以进行构造函数依赖注入，依赖通过<a href="#">内置的依赖注入容器<code>dependency injection</code></a>来提供，通过<code>IHostingEnvironment</code>的实例<code>env</code>来设定<a href="#">IConfigurationRoot</a>实例变量<code>Configuration</code>所需的数据源以便在<code>ConfigureService</code>和<code>Configure</code>方法中读取。</p>
<pre><code class="brush:csharp">  public IConfigurationRoot Configuration { get; }

  public Startup(IHostingEnvironment env)
  {
      var builder = new ConfigurationBuilder()
          .SetBasePath(env.ContentRootPath)
          .AddJsonFile(&quot;appsettings.json&quot;, optional: true, reloadOnChange: true)
          //通过IHostingEnvironment的实例env来设定实例变量Configuration所需的数据源
          .AddJsonFile($&quot;appsettings.{env.EnvironmentName}.json&quot;, optional: true);

      if (env.IsDevelopment())
      {
          // For more details on using the user secret store see https://go.microsoft.com/fwlink/?LinkID=532709
          builder.AddUserSecrets();
      }

      builder.AddEnvironmentVariables();
      Configuration = builder.Build();
  }
</code></pre>
</li>
<li><p><code>Configure</code>方法</p>
<p><code>Startup</code>类必须包含一个<code>Configure</code>方法，应用在启动时会先调用<code>ConfigureService</code>然后再调用<code>Configure</code>方法。<br><code>Configure</code>方法用来定义应用如何响应<code>HTTP</code>请求。通过向<code>IApplicationBuilder</code>实例中添加<a href="#">中间件</a>组件来配置请求管道，可以看到下面示例代码中通过调用<code>IApplicationBuilde</code>的扩展方法来配置执行管道以获得中间件的支持如error pages、BrowserLink、static files、ASP.NET MVC和Identity，调用<code>use</code>为前缀的扩展方将每一个中间件加入到执行管道中，例如用<code>UseMVC</code>扩展方法把路由中间件加入到请求管道中，并用MVC为默认的路由处理器。还有一些服务例如<code>IHostingEnvironment</code>和<code>ILoggerFactory</code>可以通过方法签名以参数方式注入。</p>
<pre><code class="brush:csharp">  // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
  public void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
  {
      loggerFactory.AddConsole(Configuration.GetSection(&quot;Logging&quot;));
      loggerFactory.AddDebug();

      if (env.IsDevelopment())
      {
          app.UseDeveloperExceptionPage();
          app.UseDatabaseErrorPage();
          app.UseBrowserLink();
      }
      else
      {
          app.UseExceptionHandler(&quot;/Home/Error&quot;);
      }

      app.UseStaticFiles();

      app.UseIdentity();

      // Add external authentication middleware below. To configure them please see https://go.microsoft.com/fwlink/?LinkID=532715

      app.UseMvc(routes =&gt;
      {
          routes.MapRoute(
              name: &quot;default&quot;,
              template: &quot;{controller=Home}/{action=Index}/{id?}&quot;);
      });
  }
</code></pre>
</li>
<li><p><code>ConfigureService</code>方法</p>
<p><code>ConfigureService</code>方法是可选的，应用在启动时会先于<code>Configure</code>方法被调用，因为功能要在被绑定到执行管道之前注册进来。方法中通过调用<code>IServiceCollection</code>的扩展方法<code>Add[Something]</code>来配置应用需要使用到的服务如Entity Framework、Identity和MVC。通过依赖注入可以使加入到服务容器中服务在应用中可用。</p>
<pre><code class="brush:csharp">  // This method gets called by the runtime. Use this method to add services to the container.
  public void ConfigureServices(IServiceCollection services)
  {
      // Add framework services.
      services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
          options.UseSqlite(Configuration.GetConnectionString(&quot;DefaultConnection&quot;)));

      services.AddIdentity&lt;ApplicationUser, IdentityRole&gt;()
          .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
          .AddDefaultTokenProviders();

      services.AddMvc();

      // Add application services.
      services.AddTransient&lt;IEmailSender, AuthMessageSender&gt;();
      services.AddTransient&lt;ISmsSender, AuthMessageSender&gt;();
  }
</code></pre>
<p>可以看到ASP.NET Corez在应用启动时通过依赖注入提供服务给应用程序，用户可以通过在<code>Startup</code>类构造函数或<code>Configure</code>和<code>ConfigureService</code>方法中以参数的方式得到需要使用的服务。上面代码中方法的执行顺序如下：</p>
</li>
</ul>
<ol>
<li>Startup(IHostingEnvironment env)</li>
<li>ConfigureServices(IServiceCollection services)</li>
<li>Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)</li>
</ol>
</li>
</ol>
<p><em>原文链接:</em></p>
<ol>
<li><em><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup" target="_blank" rel="external">https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup</a></em></li>
<li><em><a href="https://docs.microsoft.com/en-us/aspnet/core/" target="_blank" rel="external">https://docs.microsoft.com/en-us/aspnet/core/</a></em></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sharecode.cc/2016/12/06/Aspnet-Core-Web-GetStarted/" data-id="ciwonydhx0009c0gev8hy3keq" class="article-share-link">分享</a>
      
        <a href="http://sharecode.cc/2016/12/06/Aspnet-Core-Web-GetStarted/#ds-thread" class="article-comment-link">留言</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ASP-NET-Core/">ASP.NET Core</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/12/06/Aspnet-Core-Trouble-Shooting/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">ASP.NET Core 开发常见问题汇总</div>
    </a>
  
</nav>

  
</article>
  
    <section id="duoshuocomments">
<!-- 多说评论框 start -->
  <div id="ds-thread" class="ds-thread" data-thread-key="ASP.NET Core中的Program和Startup类" data-title="ASP.NET Core中的Program和Startup类" data-url="http://sharecode.cc/2016/12/06/Aspnet-Core-Web-GetStarted/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"wall-e-va"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
   </section>
  <!-- 多说公共JS代码 end -->
  
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title tagcloud">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/ASP-NET-Core/" style="font-size: 15px;">ASP.NET Core</a> <a href="/tags/Algorithm/" style="font-size: 20px;">Algorithm</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Class-Diagram/" style="font-size: 10px;">Class Diagram</a> <a href="/tags/Data-Struct/" style="font-size: 10px;">Data Struct</a> <a href="/tags/Design-Pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/PlantUML/" style="font-size: 10px;">PlantUML</a> <a href="/tags/React-Native/" style="font-size: 20px;">React Native</a> <a href="/tags/UML/" style="font-size: 10px;">UML</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title recent-posts">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/06/Aspnet-Core-Web-GetStarted/">ASP.NET Core中的Program和Startup类</a>
          </li>
        
          <li>
            <a href="/2016/12/06/Aspnet-Core-Trouble-Shooting/">ASP.NET Core 开发常见问题汇总</a>
          </li>
        
          <li>
            <a href="/2016/11/08/Write-Class-Diagram-PlantUML/">使用PlantUML画类图</a>
          </li>
        
          <li>
            <a href="/2016/11/04/React-Native-Picker/">React Native - Picker</a>
          </li>
        
          <li>
            <a href="/2016/11/03/Hexo_Hightlight/">Hexo - Hightlight source code with Google Code Prettify</a>
          </li>
        
      </ul>
    </div>
  </div>

  
     

  <div class="widget-wrap">
    <h3 class="widget-title lastest-comments">最新评论</h3>
    <div class="widget">
         <div class="hot-comments">
    <!-- 多说最新评论 start -->
	<div class="ds-recent-comments" data-num-items="5" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="70"></div>
    <!-- 多说最新评论 end -->
</div>
    </div>
  </div>



  
     


  
    
  <div class="widget-wrap">
    <h3 class="widget-title archive">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2016 Tianmin&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;181949031@qq.com
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    


    	<script type="text/javascript">
        var duoshuoQuery = {short_name:"wall-e-va"};
      </script>
      <script src="/duoshuo/embed.js"></script>


 <script src="/jquery/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/SyntaxHighlighter/3.0.83/scripts/shCore.min.js"></script>
<script type="text/javascript" src="//cdn.bootcss.com/SyntaxHighlighter/3.0.83/scripts/shBrushXml.min.js"></script>
<script type="text/javascript" src="//cdn.bootcss.com/SyntaxHighlighter/3.0.83/scripts/shBrushCSharp.min.js"></script>
<script type="text/javascript" src="//cdn.bootcss.com/SyntaxHighlighter/3.0.83/scripts/shBrushJScript.min.js"></script>
<script type="text/javascript" src="//cdn.bootcss.com/SyntaxHighlighter/3.0.83/scripts/shBrushPlain.min.js"></script>

<link type="text/css" rel="stylesheet" href="//cdn.bootcss.com/SyntaxHighlighter/3.0.83/styles/shCoreEclipse.min.css"/>

<script type="text/javascript">
  SyntaxHighlighter.config.tagName = "code";
  SyntaxHighlighter.all();
</script>
  </div>
</body>
</html>